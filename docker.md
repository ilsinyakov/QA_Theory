# Docker

## Content

## О контейнеризации

Контейнеризация - важная особенность современных операционных систем, позволяющая создавать изолированные среды внутри одного сервера. 

В случае Linux контейнеры основаны на технологии "cgroups" (control groups) и работают следующим образом: специальная программа запускает новый изолированный процесс внутри существующего дерева процессов и вызывает из него прикладные процессы.

Приложения внутри контейнеров имеют общий доступ к ресурсам с родительской операционной системой (он может быть ограничен настройками контейнера), но не имеют доступа к ресурсам вне контейнера (например, они не могут читать данные вне каталогов, которые были привязаны к контейнеру, и не имеют доступа к памяти приложений родительской операционной системы).

Существует несколько типов контейнеров для Linux, но наиболее распространенным из них является Docker. Основные возможности контейнеров Docker:
* В отличие от виртуализации контейнерам не требуются дополнительные ресурсы для запуска полной копии операционной системы - ведь контейнеры используют ядро родительской ОС.
* В отличие от виртуализации, не нужно резервировать дополнительные ресурсы, которые могут быть не использованы. Это позволяет сэкономить большое количество вычислительных ресурсов.
* Обычно в один контейнер входит только одно приложение. Например, если в вашем проекте есть frontend и backend, то лучше поместить их в отдельные контейнеры.
* Контейнеры запускаются со специальных образов дисков, которые обычно предварительно сконфигурированы, поэтому для получения рабочей копии приложения достаточно запустить его.
* Обычно контейнеры Docker имеют короткий жизненный цикл: их можно приостановить и удалить, когда они становятся ненужными, а затем снова запустить из образа. Такой подход называется "stateless", и именно поэтому не следует хранить в контейнерах критически важные данные.

## Как работает Doker

Существуют три основных компонента контейнеризации Docker:
1. **Ядро Linux** с включенной поддержкой cgroups, поставляемое по умолчанию со всеми современными дистрибутивами Linux.
2. **Containerd** - специальный сервис Linux, управляющий контейнерами Docker.
3. **Docker-CLI** (интерфейс командной строки) - специальный инструмент, передающий команды пользователя из терминала в Containerd.

Перед началом работы необходимо ознакомиться с терминологией Docker:
* **Образ (Image)**: специальный архивный файл, содержащий все дисковые данные будущих контейнеров.
* **Тег (Tag)**: специальная метка, указывающая на какой-либо параметр образа (например, версию). По умолчанию используется метка "latest", означающая последнюю версию.
* **Реестр (Registry)**: специальный удаленный сервер, на котором хранятся образы Docker.
* **Контейнер (Container)**: копия исполняемого или готового образа.

`sudo docker images` - получить список локальных образов

`sudo docker pull busybox` - получить образ из удаленного реестра

`sudo docker inspect busybox` - информация об образе

`sudo docker run --name exampleuser-2 busybox` - запустить контейнер  
`--name` - имя контейнера

`sudo docker ps` - активные контейнеры  
`-a` - все запуски

`sudo docker run --name testuser-3 -d busybox sleep 600`  
`-d` - отсоединить контейнер от терминала  
`sleep 600` - команда выполняемая в контейнере после запуска

`sudo docker exec -it testuser-3 /bin/sh` - запустить процесс терминала внутри контейнера  
`it` - интерактивный режим

`sudo docker start testuser-3` - повтороный запуск ранее запущенного контейнера

`sudo docker stop exampleuser-4` - остановить контейнер

## Работа по сети

По умолчанию Docker использует мосты и NAT для соединения контейнеров с внешней сетью. 

NAT - это механизм, позволяющий пересылать пакеты одного хоста через другой. И да, в данном случае родительский хост работает как шлюз для контейнеров Docker. Еще один важный момент в сетевом взаимодействии между контейнерами и родительским хостом - мосты, позволяющие соединить несколько интерфейсов в один. В случае Docker все интерфейсы контейнеров (с именем "veth..." на родительском хосте) объединяются в мост, который обычно называется "docker0".

`sudo docker run --name exampleuser-5 -d -P nginx`    
`P` - опубликовать все открытые порты контейнера

`sudo docker port exampleuser-5` - получить сопоставление внутреннего и внешнего портов

## Расширенные функции

