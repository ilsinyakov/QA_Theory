# Java Core

- [JVM / JRE / JDC](#jvm--jre--jdc)
  - [JVM](#jvm)
  - [JRE](#jre)
  - [JDK](#jdk)
- [Примитивы (Primitive Data Types)](#примитивы-primitive-data-types)
- [Ссылочные типы (Reference types)](#ссылочные-типы-reference-types)
- [Работа с памятью](#работа-с-памятью)

## JVM / JRE / JDC

**JVM** — Java Virtual Machine (Виртуальная машина Java) - абстрактная/реализованная машина, которая выполняет байт-код Java.

**JRE** — Java Runtime Environment (Среда выполнения Java) - пакет, содержащий JVM + стандартные библиотеки и средства запуска — нужен, чтобы просто запустить Java-программу.

**JDK** — Java Development Kit (Набор средств разработки для Java) - включает JRE + набор инструментов разработки (компилятор javac, javadoc, jar, отладчики и т.д.) — нужен разработчику.

```text
JDK
 └─ содержит JRE
     └─ содержит JVM + runtime class libraries (java.*)
```

Пример рабочего цикла:

1. `javac Hello.java` → создаёт Hello.class (байт-код).  
2. `java Hello` → JVM внутри JRE/JDK загружает и выполняет байт-код.

### JVM

JVM — не «программа», а платформа/спецификация: когда вы говорите «JVM», вы можете иметь в виду либо спецификацию (описание поведения), либо конкретную реализацию (HotSpot, OpenJ9 и т.д.).  
Разные реализации JVM имеют разные сборщики мусора (G1, Shenandoah, ZGC и т.д.), разные JIT-алгоритмы.

Основные обязанности реализации JVM:

- **Загрузка классов (Class Loader)** — загружает `.class` (байт-код) в память.
- **Проверка байт-кода (Bytecode Verifier)** — проверяет безопасность/корректность загружаемого байт-кода.
- **Исполнение байт-кода — интерпретатор + JIT (Just-In-Time) компиляция** для ускорения «горячих» участков.
- **Управление памятью и сборка мусора - GC (Garbage Collection)** — распределяет объекты в heap и запускает GC по необходимости.
- **Механизмы многопоточности и синхронизации** — реализация Java Memory Model, управление потоками и блокировками.
- **Интеграция с нативным кодом (JNI)** — возможность вызывать нативные библиотеки.

### JRE

JRE — это «пакет для запуска». В него входят:

- реализация **JVM**;
- **стандартные class libraries** (например `rt.jar` в старых версиях или модули `java.base` и другие в модульной системе);
- **java launcher** (утилита `java`), инфраструктура запуска приложений.

### JDK

JDK = JRE + инструменты разработки.

Основные элементы JDK:

- Компилятор `javac` (переводит `.java` → `.class`);
- Запускатор `java` (входит в JRE);
- Инструменты: `javadoc`, `jar`, `jlink`, `jmap`, `jstack`, профайлеры, отладчики и др.;
- Исходные заголовочные файлы и API-документация.

JDK нужен разработчику, JRE — пользователю, но в современных релизах Oracle/дистрибуции это разграничение сдвинулось - с Java 11 Oracle перестал публиковать отдельные JRE/Server-JRE для скачивания — вместо этого рекомендуется поставлять JDK или собирать тонкую runtime-сборку с помощью `jlink`. Если собираете приложение для продакшена, часто включают встроенный runtime (custom runtime) — команда `jlink` позволяет собрать минимальную runtime-сборку.

## Примитивы (Primitive Data Types)

|Примитив|Размер в памяти|Диапазон значений|Точность|
|---|---|---|---|
|**byte**|8 бит|-128 … 127|-|
|**short**|16 бит|-32 768 … 32 767|-|
|**int**|32 бит|-2 147 483 648 … 2 147 483 647|-|
|**long**|64 бит|-9 223 372 036 854 775 808 … 9 223 372 036 854 775 807|-|
|**char**|16 бит|UTF-16 code unit. 0 … 65 535 ('\u0000' … '\uffff')|-|
|**float**|32 бит|≈1.4·10^-45 … ≈3.4·10^38|~6–7 значащих десятичных цифр|
|**double**|64 бит|≈4.9·10^-324 … ≈1.8·10^308|~15–16 значащих десятичных цифр|
|**boolean**|-|true и false|-|

## Ссылочные типы (Reference types)

В Java ссылочные типы — это все типы, кроме примитивов: объекты классов, массивы, интерфейсы, String, Enum и т.д. Переменная ссылочного типа хранит ссылку (указатель) на объект в куче (heap); сам объект (его поля и внутреннее состояние) хранится в куче.

```text
Stack (локальные переменные)
+-------------------------+
| localRef -> 0x7f9a3b20  |  ← переменная (ссылка)
+-------------------------+

Heap (объекты)
0x7f9a3b20: ObjectInstance {
    [object header: mark word][klass ptr]
    field1: 123
    field2: "hello"
}
```

## Работа с памятью

Как JVM выделяет и инициализирует объект:

1. Вызывается new SomeClass().
2. JVM резервирует место в heap.
3. Пишет object header (mark word, klass ptr) и нулит поля/инициализирует по дефолту.
4. Возвращает ссылку (адрес) — значение записывается в локальную переменную (на стеке) или поле другого объекта.

|Тип|Хранение|Изменяемость|Пример|
|---|---|---|---|
|Примитив|В стеке|✅ Mutable|int a = 5|
|String|В куче|❌ Immutable|"Hello"|
|Array|В куче|✅ Mutable|int[] a = {1,2}|
|Collection|В куче|✅ Mutable (обычно)|ArrayList<>|
|Map|В куче|✅ Mutable|HashMap<>|
